# Image Classifier Configuration
# YOLO crop 이미지를 VLM으로 분류하는 시스템

# 입력/출력 경로
paths:
  input_folder: "F:/solbrain/cropped_images"  # crop된 이미지가 있는 폴더
  output_base: "./classified_images"           # 분류 결과 저장 폴더

# 지원 이미지 포맷
image_formats:
  - ".jpg"
  - ".jpeg"
  - ".png"
  - ".bmp"

# 유사도 측정 설정
similarity:
  method: "difflib"              # "difflib", "levenshtein" (향후 확장 가능)
  threshold: 0.70                # 유사도 임계값 (0.0 ~ 1.0)
  case_sensitive: false          # 대소문자 구분 여부

# 폴더 이름 정규화
folder_naming:
  normalize: true                # 폴더명 정규화 (소문자, 공백처리 등)
  use_first: true                # true: 첫 감지 단어 사용, false: 가장 많이 나온 단어
  replace_spaces: "_"            # 공백 대체 문자
  remove_special_chars: true     # 특수문자 제거

# 파일명 설정
filename:
  format: "{category}_{timestamp}_{random}"  # 파일명 형식
  timestamp_format: "%Y%m%d%H%M%S"          # 시간 포맷
  random_length: 6                           # 랜덤 문자열 길이
  preserve_extension: true                   # 원본 확장자 유지

# VLM 설정
vlm:
  prompt: "What is the main object in this image? Answer with one or two words only."
  confidence_threshold: 0.5      # 신뢰도 임계값
  max_image_size: 1280           # 최대 이미지 크기 (리사이즈)
  create_unknown_folder: true    # 미분류/낮은 신뢰도 → unknown 폴더
  temperature: 0.3               # 생성 온도 (낮을수록 일관적)
  max_new_tokens: 32             # 최대 생성 토큰 수

  # 폐색 처리 설정 (Occlusion Handling)
  occlusion_handling:
    enabled: true  # 폐색 인식 기능 활성화
    occlusion_aware_prompt: "What is the main object in this image? If you see any part of a person, even if partially hidden behind objects like fences, wires, or other obstacles, answer 'person'. Otherwise, answer with one or two words only."
    confidence_threshold_occluded: 0.4  # 폐색된 person의 낮은 신뢰도 임계값

# 처리 옵션
processing:
  show_progress: true            # 진행률 표시
  copy_or_move: "copy"           # "copy" 또는 "move"
  skip_existing: true            # 이미 처리된 파일 스킵
  save_report: true              # JSON 리포트 생성
  report_filename: "classification_report.json"

  # GPU 설정
  device: "auto"                 # "auto", "cuda", "cpu"
  empty_cache_frequency: 50      # N개 이미지마다 GPU 캐시 비우기

  # 재시도 설정
  max_retries: 3                 # VLM 쿼리 실패시 재시도 횟수
  retry_delay: 1.0               # 재시도 간 대기 시간 (초)

# 로깅 설정
logging:
  level: "INFO"                  # DEBUG, INFO, WARNING, ERROR
  save_to_file: true             # 로그 파일 저장
  log_filename: "classifier.log"

# 모델 설정 (verifier.py의 ModelManager 재사용)
model:
  cache_dir: "./models"
  selected_model: null           # null이면 자동 탐지

# 충돌 처리
conflict_resolution:
  strategy: "highest_similarity"  # "highest_similarity", "first_match", "interactive"
  log_conflicts: true             # 충돌 로그 기록
  conflict_log_file: "conflicts.json"
